name: CI - Database Backup

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  syntax-check:
    name: Python Syntax Check
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Check Python syntax
      run: |
        echo "üîç Checking Python syntax..."
        python -m py_compile database_backup.py
        python -m py_compile config.py
        echo "‚úÖ All Python files compiled successfully!"

  security-check:
    name: Security & Code Quality
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Check for secrets
      run: |
        echo "üîí Checking for potential secrets..."
        if grep -r "password\|token\|secret\|key" *.py --exclude-dir=.git; then
          echo "‚ö†Ô∏è  Warning: Review the above lines for sensitive data"
        else
          echo "‚úÖ No obvious hardcoded secrets found"
        fi

  structure-check:
    name: Project Structure Validation
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Validate project structure
      run: |
        echo "üìÅ Checking project structure..."
        required_files=("database_backup.py" "config.py" "README.md" "requirements.txt" "LICENSE" ".gitignore" ".env.example")
        for file in "${required_files[@]}"; do
          if [ -f "$file" ]; then
            echo "‚úÖ $file"
          else
            echo "‚ùå $file - MISSING"
            exit 1
          fi
        done
        echo "üéâ All required files are present!"
